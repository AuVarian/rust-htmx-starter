<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Aurune</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 1) Set theme before paint (no flash) -->
    <script>
      (() => {
        const stored = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        const isDark = stored ? stored === "dark" : prefersDark;
        document.documentElement.classList.toggle("dark", isDark);
      })();
    </script>
    <!-- htmx (your site uses it elsewhere) -->
    <script src="/static/js/htmx.min.js"></script>
    <!-- tailwind build -->
    <link rel="stylesheet" href="/static/css/app.css" />
  </head>

  <body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100">
    <header class="border-b bg-gray-50 dark:bg-gray-800">
      <nav class="bg-white border-gray-200 dark:bg-gray-900">
        <div
          class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl p-4"
        >
          <a
            class="flex items-center space-x-3 rtl:space-x-reverse"
          >
            <img
              src="https://flowbite.com/docs/images/logo.svg"
              class="h-8"
              alt="Flowbite Logo"
            />
            <span
              class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
              >Aurune</span
            >
          </a>
          <div class="flex items-center space-x-6 rtl:space-x-reverse">
            <!-- Wrapper must be relative so the popover can position against it -->
            <div class="relative">
              <button
                id="login-toggle"
                type="button"
                aria-haspopup="dialog"
                aria-expanded="false"
                aria-controls="login-popover"
                class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none
                      focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center
                      dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
              >
                Login
              </button>

              <!-- Anchored popover (hidden by default) -->
              <div
                id="login-popover"
                role="dialog"
                aria-modal="false"
                class="hidden absolute top-full right-0 mt-2 z-50 w-80 max-w-[90vw]
                      rounded-lg border border-gray-200 bg-white shadow-lg
                      dark:bg-gray-800 dark:border-gray-700"
              >
                <div class="p-4">
                  <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Login</h3>
                    <button
                      type="button"
                      class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                      id="login-close"
                      aria-label="Close"
                    >
                      âœ•
                    </button>
                  </div>

                  <form class="space-y-4" action="#">
                    <div>
                      <label for="userid" class="block mb-1 text-sm font-medium">Username</label>
                      <input
                        type="text" id="userid" name="userid" autocomplete="username"
                        class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                              focus:ring-blue-500 focus:border-blue-500
                              dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                        required
                      />
                    </div>
                    <div>
                      <label for="password" class="block mb-1 text-sm font-medium">Password</label>
                      <input
                        type="password" id="password" name="password" autocomplete="current-password"
                        class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm
                              focus:ring-blue-500 focus:border-blue-500
                              dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                        required
                      />
                    </div>
                    <button
                      type="submit"
                      class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none
                            focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5
                            dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                    >
                      Login
                    </button>
                  </form>
                </div>
              </div>
            </div>

            <button
              id="theme-toggle"
              type="button"
              class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5"
            >
              <!-- icons... -->
              <svg
                id="theme-toggle-dark-icon"
                class="hidden w-5 h-5"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                ></path>
              </svg>
              <svg
                id="theme-toggle-light-icon"
                class="hidden w-5 h-5"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </nav>
    </header>

    <main class="max-w-5xl mx-auto p-4">{% block content %}{% endblock %}</main>

    <!-- 2) Toggle logic + icon state (tiny, inline) -->
    <script>
      (() => {
        const btn = document.getElementById("theme-toggle");
        const moon = document.getElementById("theme-toggle-dark-icon"); // moon icon
        const sun = document.getElementById("theme-toggle-light-icon"); // sun icon

        function setIcons(isDark) {
          // show sun when in dark mode (next action: go light), show moon when in light mode
          sun?.classList.toggle("hidden", !isDark);
          moon?.classList.toggle("hidden", isDark);
        }

        // initial icon state
        setIcons(document.documentElement.classList.contains("dark"));

        btn?.addEventListener("click", () => {
          const isDark = !document.documentElement.classList.contains("dark");
          document.documentElement.classList.toggle("dark", isDark);
          localStorage.setItem("theme", isDark ? "dark" : "light");
          setIcons(isDark);
        });
      })();
    </script>




    <script>
    (() => {
      const btn   = document.getElementById('login-toggle');
      const panel = document.getElementById('login-popover');
      const close = document.getElementById('login-close');
      if (!btn || !panel) return;

      const firstFocusable = () =>
        panel.querySelector('input, button, [href], select, textarea, [tabindex]:not([tabindex="-1"])');

      function open() {
        panel.classList.remove('hidden');
        btn.setAttribute('aria-expanded', 'true');
        document.addEventListener('click', outside, { capture: true });
        document.addEventListener('keydown', onKey);
        firstFocusable()?.focus({ preventScroll: true });
      }

      function hide() {
        if (panel.classList.contains('hidden')) return;
        panel.classList.add('hidden');
        btn.setAttribute('aria-expanded', 'false');
        document.removeEventListener('click', outside, { capture: true });
        document.removeEventListener('keydown', onKey);
        btn.focus({ preventScroll: true });
      }

      function outside(e) {
        if (panel.contains(e.target) || btn.contains(e.target)) return;
        hide();
      }

      function onKey(e) {
        if (e.key === 'Escape') { hide(); return; }
        if (e.key === 'Tab') {
          // basic focus trap
          const nodes = panel.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])');
          if (nodes.length === 0) return;
          const first = nodes[0], last = nodes[nodes.length - 1];
          if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
          else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
        }
      }

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        panel.classList.contains('hidden') ? open() : hide();
      });

      close?.addEventListener('click', hide);
    })();
    </script>


  </body>
</html>
